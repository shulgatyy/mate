<!DOCTYPE html>
<html lang="en" manifest="temp.appcache">
<head>
	<meta charset="UTF-8">
	<title>run from localStorage</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<h3>click to run, contextmenu to clear</h3>
	<textarea></textarea>
	<script>
		let functionBody = localStorage.getItem('onLoadFunctionBody');
		if (functionBody) {
			try {
				const onClick = new Function(functionBody);
				document.onclick = e => {
					const tag = e.target.tagName;
					try {
						if (tag == 'HTML' || tag=='BODY')
							onClick();
					} catch (e) {
						alert(e);
					}
				};
			} catch (e) {
				alert('new ' + e);
			}
		} else {
			functionBody = prompt('paste function', 'alert(1)');
			if (functionBody && /^[\w\/\-]+$/.test(functionBody)) {
				document.body.style.border = '1px solid green';
				fetch(`https://gist.githubusercontent.com/${functionBody}/raw`)
					.then(r => r.text())
					.then(r => r.replace(/\s*\/\/.*/g, ''))
					.then(r => localStorage.setItem('onLoadFunctionBody', r))
					.then(() => location.reload())
					.catch(alert);
			} else if (functionBody) localStorage.setItem('onLoadFunctionBody', functionBody);
		}
		document.oncontextmenu = e => {
			e.preventDefault();
			localStorage.removeItem('onLoadFunctionBody');
			alert('cleared');
		};
		document.body.querySelector('textarea').onchange = e => localStorage.setItem('onLoadFunctionBody', e.target.value);
	</script>
</body>
</html>
