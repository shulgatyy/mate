<!DOCTYPE html>
<html lang="en" manifest="temp.appcache">
<head>
	<meta charset="UTF-8">
	<title>run from localStorage</title>
</head>
<body>
	<h3>click to run, contextmenu to clear</h3>
	<script>
		let functionBody = localStorage.getItem('onLoadFunctionBody');
		if (functionBody) {
			const onClick = new Function(functionBody);
			document.onclick = () => {
				try {
					onClick();
				catch (e) {
					alert(e);
				}
			};
		} else {
			functionBody = prompt('paste function', 'alert(1)');
			if (functionBody && /^[\w\/\-]+$/.test(functionBody))
				fetch(`https://gist.githubusercontent.com/${functionBody}/raw`)
					.then(r => r.text())
					.then(r => r.replace(/\s*\/\/.*/g, ''))
					.then(r => localStorage.setItem('onLoadFunctionBody', r))
					.then(() => location.reload())
					.catch(alert);
			else if (functionBody) localStorage.setItem('onLoadFunctionBody', functionBody);
		}
		document.oncontextmenu = e => {
			e.preventDefault();
			localStorage.removeItem('onLoadFunctionBody');
			alert('cleared');
		};
	</script>
</body>
</html>
